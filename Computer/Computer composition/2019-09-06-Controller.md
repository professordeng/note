---
title: 5.4 控制器的功能和工作原理
date: 2019-11-26
---

## 1. 控制器的结构和功能

计算机硬件系统的五大功能部件通过**数据总线**、**地址总线**和**控制总线**连接在一起（统称为系统总线），其中控制器包括指令寄存器（IR）、程序计数器（PC）以及控制信号产生电路。（P206）

现对其主要连接关系简单说明如下：

1. 运算器部件通过**数据总线**与内存储器、输入设备和输出设备传送数据。
2. 输入设备和输出设备通过**接口电路**与总线相连接。
3. 内存储器、输入设备和输出设备从**地址总线**接收地址信息，从控制总线得到控制信号，通过**数据总线**与其他部件传送数据。
4. 控制器部件从**数据总线**接收指令信息，从运算器部件接收指令转移地址，送出指令地址到地址总线，还要向系统中的部件提供它们运行所需要的控制信号。

控制器是计算机系统的指挥中心，控制器的主要功能有：

1. 从主存中取出一条指令，并指出下一条指令在主存中的位置。
2. 对指令进行译码或测试，产生相应的操作控制信号，以便启动规定的动作。
3. 指挥并控制 CPU、主存、输入和输出设备之间的数据流动方向。

根据控制器产生微操作控制信号的方式的不同，控制器可分为**硬布线控制器**和**微程序控制器**，两类控制器中的 PC 和 IR 是相同的，但确定和表示指令执行步骤的办法以及给出控制各部件运行所需要的控制信号的方案是不同的。

## 2. 硬布线控制器

硬布线控制器的基本原理是根据指令的要求、当前的时序及外部和内部的状态，按时间的顺序发送一系列微操作控制信号。它由复杂的组合逻辑门电路和一些触发器构成，因此又称为组合逻辑控制器。

### 2.1 硬布线控制单元

指令的操作码是决定控制单元发出不同操作命令（控制信号）的关键。为了简化控制单元（CU）的逻辑，将指令的操作码**译码**和**节拍发生器**从 CU 分离出来，便可得到简化的控制单元。（P206）

CU 的输入信号来源如下：

1. 经**指令译码器**译码产生的指令信息。现行指令的操作码决定了不同指令在执行周期所需完成的不同操作，故指令的**操作码字段**是控制单元的输入信号，它与时钟配合产生不同的控制信号。
2. 时序系统产生的**机器周期信号**和**节拍信号**。为了使控制单元按一定的先后顺序、一定的节奏发出各个控制信号，**控制单元必须受时钟控制**，即一个时钟脉冲使控制单元发送一个操作命令，或发送一组需要同时执行的操作命令。
3. **来自执行单元的反馈信息**即标志。控制单元有时需依赖 CPU 当前所处的**状态产生控制信号**，如 BAN 指令，控制单元要根据上条指令的结果**是否为负**来产生不同的控制信号。

节拍发生器产生**各机器周期中的节拍信号**，使不同的微操作命令 `Ci` （控制信号）按时间的先后发出。个别指令的操作不仅受操作码控制，还受状态标志控制，因此 CU 的输入来自**操作译码电路 ID**、**节拍发生器**及**状态标志**，其输出到 CPU 内部或外部控制总线上。

注意：控制单元来接收来自**系统总线**（控制总线）的控制信号，如中断请求、DMA 请求。

### 2.2 硬布线控制器的时序系统及微操作

1. 时钟周期。用时钟信号控制节拍发生器，可以产生节拍，**每个节拍的宽度正好对应一个时钟周期**。在每个节拍内机器可完成**一个或几个**需同时执行的操作。
2. 机器周期。机器周期可视为**所有指令执行过程中的一个基准时间**。不同指令的操作不同，指令周期也不同。访问一次存储器的时间是固定的，因此**通常以存取周期作为基准时间**，即内存中**读取一个指令字的最短时间**作为机器周期。在存储字长等于指令字长的**前提**下，取指周期也可视为机器周期。
3. 指令周期。CPU 完成一条指令的周期。详见 5.2 节
4. 微操作命令分析。控制单元具有发出各种操作命令（控制信号）序列的功能。这些命令与指令有关，而且必须按一定次序发出，才能使机器有序地工作。

执行次序的过程中，对于不同的指令、控制单元需发出各种不同的微操作命令。一条指令分为 3 个工作周期：取指周期、间址周期和执行周期。下面分析各个子周期的微操作命令。

1. 取指周期的微操作命令。无论是什么指令，取指周期都需有下列微操作命令：

   ```assembly
   PC → MAR      ; 现行指令地址 → MAR
   1 → R         ; 命令存储器读
   M(MAR) → MDR  ; 现行指令从存储器中读至 MDR
   MDR → IR      ; 现行指令 → IR
   OP(IR) → CU   ; 指令的操作码 → CU 译码
   (PC)+1 → PC   ; 形成下一条指令的地址
   ```

2. 间址周期的微操作命令。间址周期完成取操作数地址的任务，具体微操作命令如下：

   ```assembly
   Ad(IR) → MAR    ; 将指令字中的地址码（形式地址）→ MAR
   1 → R           ; 命令存储器读
   M(MAR) → MDR    ; 将有效地址从存储器读至 MDR
   ```

3. 执行周期的微操作命令。执行周期的微操作命令视不同指令而定。

   a. 非访存指令

   ```markdown
   CLA    清 ACC     
   	0 → ACC
   COM    取反       
   	not(ACC) → ACC
   SHR    算术右移    
   	L(ACC) → R(ACC)
	ACC0 → ACC0
   CSL    循环左移    
	R(ACC) → L(ACC)
   	ACC0 → ACCn
   STP    停机指令    
   	0 → G
   ```
   
   b. 访存指令
   
   ```markdown
   ADD X    加法指令     
   	Ad(IR) → MAR
   	1 → R
   	M(MAR) → MDR
   	(ACC) + (MDR) → ACC
   STA X    存数指令    
	Ad(IR) → MAR
   	1 → W
	ACC → MDR
   	MDR → M(MAR)
   LDA X    取数指令     
   	Ad(IR) → MAR
   	1 → R
   	M(MAR) → MDR
   	MDR → ACC
   ```
   
   c. 转移指令
   
   ```markdown
   JMP X   无条件转移    
   	Ad(IR) → PC
   BAN X   条件转移(负则转)   
   	A0·Ad(IR) + not(A0)·(PC) → PC
   ```

### 2.3 CPU 的控制方式

控制单元控制一条指令执行的过程，实质上是依次执行一个**确定的微操作序列**的过程。由于不同指令所对应的微操作数及复杂程度不同，因此每条指令和每个微操作所需的执行时间也不同。主要有以下 3 种控制方式。

1. 同步控制方式。所谓同步控制方式，是指系统有一个统一的时钟，所有的控制信号均来自这个统一的时钟信号。通常以**最长的微操作序列**和**最烦琐的微操作**作为标准，采取完全统一的、具有相同时间间隔和相同数目的节拍作为机器周期来运行不同的指令。

   同步控制方式的优点是控制电路简单，缺点是运行速度慢。

2. 异步控制方式。异步控制方式不存在基准时标信号，各部件按自身固有的速度工作，通过**应答方式**进行联络。

   异步控制方式的优点是运行速度快，缺点是控制电路比较复杂。

3. 联合控制方式。联合控制方式是介于同步、异步之间的一种折中。这种方式对各种不同的指令的微操作实现大部分采用同步控制、小部分采用异步控制的方法。

### 2.4 硬布线控制单元设计步骤

硬布线控制单元设计步骤包括：

1. 列出微操作命令的操作时间表。先根据微操作节拍安排，列出微操作命令的操作时间表。操作时间表中包括各个机器周期、节拍下的每条指令完成的微操作控制信号。

   下表列出了 CLA、COM、SHR 等 10 条机器指令微操作命令的操作时间表。表中 `FE`、`IND` 和 `EX` 为 CPU 工作周期标志，`T0~T2` 为节拍，`I` 为间址标志，在取指周期的 `T2` 时刻，若测得 `I=1` ，则 `IND` 触发器置 `1` 。标志进入间址周期；若 `I=0` ，则 `EX` 触发器置 `1` ，标志进入执行周期。同理，在间址周期的 `T2` 时刻，若测得 `IND=0` （表示一次间接寻址），则 `EX` 触发器置 `1` ，进入执行周期；若测得 `IND=1` （表示多次间接寻址），则继续间接寻址。在执行周期 `T2` 时刻，CPU 要向所有中断源发中断查询信号，若检测到有中断请求并满足响应条件，则 `INT` 触发器置 `1` ，标志进入中断周期。表中未列出 `INT` 触发器置 `1` 的操作和中断周期的微操作。表中第一行对应 10 条指令的操作码，代表不同的指令。若某指令有表中所列出的微操作命令，其对应的单元格内为 1。

   ![操作时间表](/computer-system/img/OT.png) 

2. 进行微操作信号综合。在列出微操作时间表后，即可对它们进行综合分析、归类，根据微操作时间表可写出各微操作控制信号的逻辑表达式并进行适当的简化。表达式一般包括下列元素：

   ```markdown
   微操作控制信号 = 机器周期 ∧ 节拍 ∧ 脉冲 ∧ 操作码 ∧ 机器状态条件
   ```

   根据列表中每个微操作命令的初始逻辑表达式，经化简、整理可获得能用现有门电路实现的微操作命令逻辑表达式。

   例如，根据列表可写出 `M(MAR) → MDR` 微操作命令的逻辑表达式：

   ```markdown
   M(MAR) → MDR
   = FE·T1 + IND·T1(ADD + STA + LDA + JMP + BAN) + EX·T1(ADD + LDA)
   = T1{FE + IND(ADD + STA + LDA + JMP + BAN) + EX(ADD + LDA)}
   ```

   式中，ADD、STA、LDA、JMP、BAN 均来自操作码译码器的输出。

3. 画出微操作命令的逻辑图。根据逻辑表达式可画出对应每个微操作信号的逻辑电路图，并用逻辑门电路实现。（P210）

## 3. 微程序控制器

微程序控制器采用**存储逻辑**实现，也就是把微操作信号代码化，使每条机器指令转化为一段微程序并存入一个专门的存储器（控制存储器）中，微操作控制信号由微指令产生。

### 3.1 微程序控制的基本概念

微程序设计思想就是将每条机器指令编写成一个微程序，每个微程序包含若干微指令，每条微指令对应一个或几个微操作命令。这些微程序可以存到一个控制存储器中，用寻址用户程序机器指令的办法来寻址每个微程序的微指令。目前，大多数计算机都采用微程序设计技术。

微程序设计技术涉及的基本术语如下：

1. 微命令和微操作。一条机器指令可以分解成一个微操作序列，这些**微操作是计算机中最基本的、不可再分解的操作**。在微程序控制的计算机中，将**控制部件向执行部件发出的各种控制命令**称为微命令，它是构成控制序列的最小单位。例如，打开或关闭某个控制门的电位信号、某个寄存器的打入脉冲等。微命令和微操作是一一对应的。微命令是微操作的控制信号，微操作是微命令的执行过程。

   微命令有相容性和互斥性之分。相容性微命令是指那些可以同时产生、共同完成某一些微操作的微命令；而互斥性微命令是指在机器中不允许同时出现的微命令。相容和互斥都是相对的，一个微命令可以和一些微命令相容，和另一些微命令互斥。

   注意：在组合逻辑控制器中也存在微命令与微操作这两个概念，它们并非只是微程序控制器的专有概念。

2. 微指令与微周期。**微指令是若干微命令的集合**。存放微指令的控制存储器的单元地址称为微地址。一条微指令通常至少包含两大部分信息：

   1. 操作控制字段，又称微操作码字段，用于产生某一步操作所需的各种操作控制信号。
   2. 顺序控制字段，又称微地址码字段，用于控制产生下一条要执行的微指令地址。

   微周期通常指从控制存储器中读取一条微指令并执行相应的微操作所需的时间。

3. 主存储器与控制存储器。主存储器用于存放程序和数据，在 CPU 外部，用 RAM 实现；控制存储器（CM）用于存放微程序，在 CPU 内部，用 ROM 实现。

4. 程序与微程序。**程序是指令的有序集合**，用于完成特定的功能；**微程序是微指令的有序集合**，一条指令的功能由一段微程序来实现。

微程序和程序是两个不同的概念。微程序是由微指令组成的，用于描述机器指令。微程序实际上是机器指令的实时解释器，是由计算机设计者事先编制好并存放在控制存储器中的，一般不提供给用户。对于程序员来说，计算机系统中微程序的结构和功能是透明的，无须知道。而程序最终由机器指令组成，是由软件设计人员事先编制好并存放在主存或辅存中的。

注意区分以下寄存器

1. 地址寄存器（MAR）。用于存放主存的读/写地址。
2. 微地址寄存器（CMAR）。用于存放控制存储器的读/写微指令的地址。
3. 指令寄存器（IR）。用于存放从主存中读出的指令。
4. 微指令寄存器（CMDR 或 μIR）。用于存放从控制存储器中读出的微指令。

### 3.2 微程序控制器组成和工作过程

1. 微程序控制器的基本组成

   1. 控制存储器。它是**微程序控制器**的核心部件，用于**存放**各指令对应的微程序，控制存储器可用只读存储器 ROM 构成。
   2. 微指令寄存器。用于存放从 CM 中取出的微指令，它的位数同微指令字长相等。
   3. **微地址形成部件**。用于产生初始微地址和后继微地址，以保证微指令的连续执行。
   4. 微地址寄存器。接收微地址形成部件送来的微地址，为在 CM 中读取微指令作准备。

2. 微程序控制器的工作过程

   微程序控制器的工作过程实际上就是**在微程序控制器的控制下计算机执行机器指令**的过程，这个过程可以描述如下：

   1. 执行取微指令公共操作。具体的执行是：在机器开始运行时，自动将取指微程序的入口地址送入 CMAR，并从 CM 中读出相应的微指令送入 CMDR。**取指微程序的入口地址**一般为 CM 的 0 号单元，**当取指微程序执行完后，从主存中取出的机器指令就已经存入指令寄存器中**。
   2. 由**机器指令的操作码字段**通过微地址形成部件产生**该机器指令所对应的微程序的入口地址**，并送入 CMAR。
   3. 从 CM 中逐条取出相应的微指令并执行。
   4. 执行完对应于一条机器指令的微程序后，又回到取指微程序的入口地址，继续第 1 步，以完成**取下一条机器指令的公共操作**。

   以上是一条机器指令的执行过程，如此周而复始，直到整个程序执行完毕。

3. 微程序和机器指令。

   通常，**一条机器指令对应一个微程序**。由于任何一条机器指令的取指操作都是相同的，因此可**将取指令操作的微命令统一编成一个微程序**，这个微程序只负责将指令从主存单元中取出并送至指令寄存器。

   此外，也可编出对应**间址周期的微程序**和**中断周期的微程序**。这样，控制存储器中的微程序个数应该为机器指令数再加上对应取指、间址和中断周期等共用的微程序数。

   注意：若指令系统中具有 n 种机器指令，则控制存储器中的微程序至少是 n+1（1 为公共的取指微程序）。

### 3.3 微指令的编码方式

微指令的编码方式又称微指令的控制方式，是指如何**对微指令的控制字段进行编码**，以形成控制信号。编码的目标是在保证速度的情况下，尽量缩短微指令字长。

1. 直接编码（直接控制）方式（P212）

   直接编码法无须进行译码，微指令的**微命令字段中每位都代表一个微命令**。设计微指令时，选用或不选用某个微命令，只要将表示该微命令的对应位设置成 1 或 0 即可。每个微命令对应并控制数据通路中的一个微操作。

   这种编码的优点是简单、直观，执行速度快，操作并行性好；缺点是**微指令字长过长**，n 个微指令就要求微指令的操作字段有 n 位，造成控制存储器容量极大。

2. 字段直接编码方式（P212）

   将微指令的微命令字段分成若干小字段，把**互斥性微命令组合在同一字段**中，把相容性微命令组合在不同字段中，每个字段独立编码，每种编码代表一个微指令且**各字段编码含义单独定义，与其他字段无关**，这就是字段直接编码方式。

   微指令字段分段的原则：

   1. 互斥性微命令分在同一段内，相容性微命令分在不同段内。
   2. 每个小段中包含的信息位不能太多，否则将增加译码线路的复杂性和译码时间。
   3. 一般每个小段还要留出一个状态，表示本字段不发出任何微命令。因此，当某字段的长度为 3 位时，最多只能表示 7 个互斥的微命令，通常用 000 表示不操作。

3. 字段间接编码方式

   一个字段的某些微指令需由另一个字段中的某些微命令来解释，由于**不是靠字段直接译码**发出的微命令，故称为字段间接编码，又称隐式编码。这种方式可进一步缩短微指令字长，但因削弱了微指令的并行控制能力，因此通常作为**字段直接编码方式的一种辅助手段**。

### 3.4 微指令的地址形成方式

后继微地址的形成主要有以下两大类基本类型：

1. 直接由微指令的**下地址字段**指出。微指令格式中设置一个下地址字段，由微指令的下地址字段直接指出后继微指令的地址，这种方式又称**断定方式**。
2. 根据机器指令的操作码形成。机器指令取至指令寄存器后，微指令的地址**由操作码经微地址形成部件形成**。

实际上，微指令序列地址的形成还有以下几种。

1. 增量计数器法，即 `(CMAR)+1 → CMAR` ，适用于后继指令的地址连续的情况。
2. 根据各种标志决定微指令分支转移的地址。
3. 通过网络测试形成。
4. 由硬件直接产生微程序入口地址。

电源通电后，第一条微指令的地址可由专门的硬件电路产生，也可由外部直接向 CMAR 输入微指令的地址，这个地址即为**取指周期微程序**的入口地址。

### 3.5 微指令的格式

微指令格式与微指令的编码方式有关，通常分水平型微指令和垂直型微指令两种。

1. 水平型微指令。从编码方式看，直接编码、字段直接编码、字段间接编码和混合编码都属于水平型微指令。指令字中的一位对应一个控制信号，有输出时为 1，否则为 0。一条水平型微指令定义并执行几种并行的基本操作（不同字段的操作码可并行）。

   水平型微指令的优点是微程序短，执行速度快；缺点是微指令长，编写微程序较麻烦。（P213）

2. 垂直型微指令。垂直型微指令的特点是采用**类似机器指令操作码的方式**，在微指令中设置微操作码字段，采用微操作码编译法，由微操作码规定微指令的功能。一条垂直型微指令只能定义并执行一种基本操作（一条指令只有一个操作码）。

   垂直型微指令格式的优点是微指令短、简单、规整，便于编写微程序；缺点是**微程序长**，执行速度慢，工作效率低。

3. 混合型微指令。在垂直型的基础上增加一些不太复杂的并行操作。微指令较短，仍便于编写；微程序也不长，执行速度加快。

4. 水平型微指令和垂直型微指令的比较如下：

   1. 水平型微指令并行操作能力强、效率高、灵活性强；垂直型微指令则较差。
   2. 水平型微指令执行一条指令的时间短；垂直型微指令执行的时间长。
   3. 由水平型微指令解释指令的微程序，具有微指令字较长但微程序短的特点；垂直型微指令则与之相反，其微指令字较短而微程序长。
   4. 水平型微指令用户难以掌握，而垂直型微指令与指令比较相似，相对容易掌握。

### 3.6 微程序控制单元的设计步骤

微程序控制单元设计的主要任务是编写各条机器指令所对应的微程序。具体的设计步骤如下：

1. 写出对应机器指令的**微操作命令**及**节拍安排**。无论是组合逻辑设计还是微程序设计，对应相同的 CPU 结构，两种控制单元的微操作命令和节拍安排都是极相似的。如微程序控制单元在取指阶段发出的微操作命令及节拍安排如下：

   ```markdown
   T0  PC → MAR，1 → R
   T1  M(MAR) → MDR，(PC)+1 → PC
   T2  MDR → IR，OP(IR) → 微地址形成部件
   ```

   与硬布线控制单元相比，只有在 `T2` 节拍内的微操作命令不同。微程序控制单元在 `T2` 节拍内要将指令的操作码送至微地址形成部件，即 `OP(IR) → 微地址形成部件` ，以形成该条机器指令的微程序首地址。而硬布线控制单元在 `T2` 节拍内要将指令的操作码送至指令译码器，以控制 CU 发出相应的微指令，即 `OP(IR) → ID` 。

   若把一个节拍 T 内的微操作安排在一个微指令中完成，上述微操作对应 3 条微指令。但由于微程序控制的所有控制信号都来自微命令，而微指令又存在控制存储器中，因此欲完成上述这些微操作，必须先将微指令从控制存储器中读出，即必须先给出这些微指令的地址。在取指微程序中，除第一条微指令外，其余微指令的地址均由上一条微指令的下地址字段直接给出，因此上述每条微指令都需增加一个将微指令下地址字段送至 CMAR 的操作，记为 `Ad(CMDR) → CMAR` 。取指微程序的最后一条微指令，其后继微指令的地址是由微地址形成部件形成的，即 `微地址形成部件 → CMDR`。为了反映该地址与操作码有关，故记为 `OP(IR) → 微地址形成部件 → CMAR`。

   综上所述，考虑到需要形成后继微指令地址，上述分析的取指操作共需 6 条微指令完成。

   ```markdown
   T0  PC → MAR，1 → R
   T1  Ad(CMDR)→CMAR
   T2  M(MAR) → MDR，(PC)+1 → PC
   T3  Ad(CMDR) → CMAR
   T4  MDR → IR
   T5  OP(IR) → 微地址形成部件 → CMAR
   ```

   执行阶段的微操作命令及节拍安排，分配原则类似。与硬布线控制单元微操作命令的节拍安排相比，**多了将下一条微指令地址送至 CMAR 的微操作命令**，即 `Ad(CMDR) → CMAR` 。其余的微操作命令与硬布线控制单元相同。

   注意：这里为了理解，应将微指令和机器指令相联系，因为每执行完一条微指令后要得到下一条微指令的地址。

2. 确定微指令格式。微指令格式包括**微指令的编码方式**、**后继微指令地址的形成方式**和**微指令字长**等。

   根据微操作个数决定采用何种编码方式，以确定微指令的操作控制字段的位数。由微指令数确定微指令的**顺序控制字段**的位数。最后按操作控制字段位数和顺序控制字段位数就可确定微指令字长。

3. 编写微指令码点。根据操作控制字段每位代表的微操作命令，编写每条微指令的码点。

### 3.7 动态微程序设计和毫微程序设计

1. 动态微程序设计。在一台微程序控制的计算机中，假如能根据用户的要求改变微程序，则这台机器就具有动态微程序设计功能。

   动态微程序的设计需要可写控制寄存器的支持，否则难以改变微程序的内容。实现动态微程序设计可采用可擦除可编程只读存储器（EPROM）。

2. 毫微程序设计。在普通的微程序计算机中，从主存取出的每条指令是由放在控制存储器中的微程序来解释执行的，通过控制线对硬件进行直接控制。

   若硬件不由微程序直接控制，而是通过存放在**第二级控制存储器**中的毫微程序来解释的，这个第二级控制存储器就称为毫微存储器，**直接控制硬件的是毫微微指令**。

### 3.8 硬布线和微程序控制器的特点

1. 硬布线控制器的特点。硬布线控制器的优点是由于控制器的速度取决于电路延迟，所以速度快；缺点是由于将控制部件视为专门产生固定时序控制信号的逻辑电路，所以把最少元件和取得最高速度作为设计目标，一旦设计完成，就**不可能通过其他额外修改添加新功能**。
2. 微程序控制器的特点。微程序控制器的优点是同组合逻辑控制器相比，微程序控制器具有**规整性**、灵活性、可维护性等一系列优点；缺点是由于微程序控制器采用了存储程序原理，所以每条指令都要从控制存储器中取一次，**影响速度**。

为便于比较，下面以表格的形式对比二者的不同

|          | 微程序控制器                                                 | 硬布线控制器                                                 |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 工作原理 | 微操作控制信号以微程序的形式存放在控制存储器中，执行指令时读出即可 | 微操作控制信号由组合逻辑电路根据当前的指令码、状态和时序，即时产生 |
| 执行速度 | 慢                                                           | 快                                                           |
| 规整性   | 较规整                                                       | 烦琐、不规整                                                 |
| 应用场合 | CISC CPU                                                     | RISC CPU                                                     |
| 易扩充性 | 易扩充修改                                                   | 困难                                                         |

## 4. 习题

1. 微操作控制信号主要与什么有关？
2. 形成微程序入口地址是？
3. 微程序控制器和硬布线控制器相比，谁的时序系统简单？
4. 机器指令和微指令的关系？
5. 地址字段的位数取决于什么？
6. 通常一个微程序的周期对应于？
7. 属于控制部件的有？
8. 属于运算器部件的有？
9. CPU 周期是指？
10. 代码长度如何计算？
11. 进/借位标志 CF 的计算过程
12. 运算器的标志位都有哪些？
13. 进位标志和溢出标志有何区别？
14. 为何 0-(-1) 的情况下， CF 是 1 ？
15. 如何快速求出进/借位标志 CF 和溢出标志 OF

## 5. 习题答案

1. 输入信号有：

   1. 经指令译码器译码产生的指令信息
   2. 时序系统产生的机器周期信号和节拍信号
   3. 来自执行单元的反馈信号即标志

   前两者是主要因素。

2. 机器指令的操作码字段

3. 微程序控制器的时序系统简单。硬布线控制器需要结合各微指令的节拍安排，综合分析，写出逻辑表达式，在设计成逻辑电路图，因此时序系统比较复杂；而微程序只需按照节拍的安排，顺序执行微指令，因此比较简单。

4. 每条机器指令由若干微指令组成的微程序来解释执行。微指令由多个微操作（微命令）组成。

5. 控制存储器的大小，而控制存储器的大小取决于所有微程序大小之和。

6. 指令周期；只不过每个指令周期都有取指阶段，所以会将取指阶段独立编程成一个微程序。

7. 指令寄存器、操作控制器、程序计数器

8. 状态条件寄存器

9. 机器周期。是指令执行中每步操作所需的时间

10. 结束地址 - 开始地址 + 结束地址所指的数据类型格式长度

11. 减法运算时，做补码运算，若有进位，则进位标志 C = 1，否则 C =0；而借位标志 CF = 进位标志⊕1。

12. CF（进位标志），算术操作最高位产生了进位或借位时 CF=1，否则 CF=0。

    PF（奇偶标志） ，数据最低 8 位中 1 的个数为偶数时 PF=1，否则 PF= 0。

    AF（辅助进位标志），用以表示加减法做到一半时有形成进位/借位时 AF=1，否则 AF=0。

    ZF（零标志），操作结果为 0 时 ZF=1，否则 ZF=0。

    SF（符号标志） 结果最高位为1 时 SF=1，否则 SF=0。

    OF（溢出标志），运算发生了溢出时 OF=1， 否则等于 0。

13. 进位判断方法：加减时最高位产生进位或借位，代表结果超出无符号数的范围，单字节就是 0~255；

    溢出判断方法：加减时最高位和次高位中有且仅有一个产生进位或借位，代表结果超出有符号数的范围，单字节就是-128~127；

    ```markdown
以下是有符号数在补码下的运算：
    
01100000 + 01110000 = 11010000
    正数相加得负数，有溢出 OF=1， 不产生进位 CF=0
    
    00111100 + 11110010 = (1)00101110
    结果正确，不会溢出（正加负）OF=0， 有进位（1），所以 CF=1
    ```
    
14. 把机器数看成补码，这只是人的想法。

    负数求补码的时候，按照其定义式就是用 `模-负数的绝对值` 。

    这里面，就平白的多了一个模。（你不要想着用求反加一来求补码，这种方法也对，但是掩盖真相）

    所以用补码来计算，就会差了一个进位。这个进位就是求补码时加进去的模。

