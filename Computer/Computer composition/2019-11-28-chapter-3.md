---
title: 3. 存储系统
date: 2019-11-10
---

## 1. 小结

1. 存储器的层次结构主要体现在何处？为何要分这些层次？计算机如何管理这些层次？

   存储器的层次结构主要体现在 Cache~主存和主存~辅存这两个存储层次上。

   Cache~主存层次在存储系统中主要对 CPU 访存起加速作用，即从整体运行的效果分析，CPU 访存速度加快，接近于 Cache 的速度，而寻址空间和位价却接近于主存。

   主存~辅存层次在存储系统中主要起扩容作用，即从程序员的角度看，他所使用的存储器的容量和位价接近于辅存，而速度接近于主存。

   综合上述两个存储层次的作用，从整个存储系统来看，就达到了速度快、容量大、位价低的优化效果。

   主存与 Cache 之间的信息调度功能全部由硬件自动完成。而主存与铺存层次的调度目前广泛采用虚拟存储技术实现，即将主存与辅存的一部分通过软/硬结合的技术组成虚拟存储器，程序员可用这个比主存实际空间（物理地址空间）大得多的虚拟地址空间（逻辑地址空间）编程，当程序运行时，再由软/硬件自动配合完成虚拟地址空间与主存实际物理空间的转换。因此，这两个层次上的调度或转换操作对于程序员来说都是透明的。

2. 存取周期和存取时间有何区别？

   存取周期和存取时间的主要区别是：存取时间仅为完成一次操作的时间；而存取周期不仅包含操作时间，而且包含操作后线路的恢复时间，即存取周期 = 存取时间 + 恢复时间。

3. 在虚拟存储器中，页面是设置得大一些好还是设置得小一些好？

   页面不能设置得过大，也不能设置得过小。因为页面太小时，平均页内剩余空间较少，可节省存储空间，但会使得页表增大，而且页面太小时不能充分利用访存的空间局部性来提高命中率；页面太大时，可减少项表空间，但平均页内剩余空间较大，会浪费较多存储空间，页面太大还会使页面调入/调出的时间较长。

## 2. 查缺补漏

1. 存取时间 Ta 就是存储周期 Tm 吗？

   不是，存取时间 Ta 是执行一次读操作或写操作的时间，分为读出时间和写入时间。读出时间是从主存接收到有效地址开始到数据稳定为止的时间；写入时间是从主存接收到有效地址开始到数据写入被写单元为止的时间。

   存储周期 Tm 是指存储器进行连续两次独立地读或写操作所需的最小时间间隔。所以存取时间不等于存储周期 Tm。通常存储周期 Tm 大于存取时间 Ta。

2.  Cache 行的大小和命中率之间有什么关系？

   行的长度较大，可以充分利用程序访问的空间局部性，使一个较大的局部空间被一起调到 Cache 中，因而可以增加命中机会。但是,，行长也不能太大，主要原因有两个：

   1. 行长大使失效损失变大。也就是说，若未命中，则需花更多时间从主存读块。
   2. 行长太大，Cache 项数变少，因而命中的可能性变小。

3. 发生取指今 Cache 缺失的处理过程是什么？

   1. 程序计数器恢复当前指令的值。
   2. 对主存进行读的操作
   3. 将读入的指令写入 Cache 中，更改有效位和标记位
   4. 重新执行当前指令

4. 关于 Cache 的一些小知识

   1. 多级 Cache，现代计算机系统中，一般采用多级的 Cache 系统，CPU 执行指令时，先到速度最快的一级  Cache（L1 Cache）中寻找指令或数据，找不到时，再到速度次快的二级 Cache（L2 Cache）中找 ……… 最后到主存中找。
   2. 指令 Cache 和数据 Cache。指令和数据可以分别存储在不同的 Cache 中（L1 Cache 一般会这么做），这种结构也称哈佛 Cache，其特点是允许 CPU 在同一个 Cache 存储周期内同时提取指令和数据，由于指令执行过程取指和取数据都有可能访问 Cache，因此这一特性可以保证不同的指令同时访存