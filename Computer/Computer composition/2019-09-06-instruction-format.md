---
title: 4.1 指令格式
date: 2019-11-19
---

指令（又称机器指令）是指示计算机执行某种操作的命令，是计算机运行的最小功能单位。一台计算机的所有指令的集合构成该机的指令系统，也称指令集。指令系统是计算机的主要属性，位于硬件和软件的交界面上。

## 1. 指令的基本格式

一条指令就是机器语言的一个语句，它是一组有意义的二进制代码。一条指令通常包括操作码字段和地址码字段两部分（指令 = 操作码字段 + 地址码字段）。

其中，操作码指出指令中该指令应该执行什么性质的操作和具有何种功能。操作码是识别指令、了解指令功能及区分操作数地址内容的组成和使用方法等的关键信息。例如，指出是算术加运算还是算术减运算，是程序转移还是返回操作。

地址码给出被操作的信息（指令或数据）的地址，包括参加运算的一个或多个操作数所在的地址、运算结果的保持地址、程序的转移地址、被调用的子程序的入口地址等。

指令的长度是指一条指令中所包含的二进制代码的位数。指令字长取决于操作码的长度、操作数地址码的长度和操作数地址的个数。**指令长度与机器字长没有固定的关系**，它可以等于机器字长，也可以大于或小于机器字长。通常，把指令长度等于机器字长的指令称为**单字长指令**，指令长度等于半个机器字长的指令称为**半字长指令**，指令长度等于两个机器字长的指令称为**双字长指令**。

在一个指令系统中，若所有指令的长度都是相等的，则称为**定长指令字结构**。定字长指令的执行速度快，控制简单。若各种指令的长度随指令功能而异，则称为变长指令字结构。然而，因为主存一般是按字节编址的，所以指令字长多为字节的整数倍。

根据指令中操作数地址码的数目的不同，可将指令分成以下几种格式。

### 1.1 零地址指令

```assembly
OP
```

只给出操作码 OP，没有显式地址。这种指令有两种可能：

1. 不需要操作数的指令，如空操作指令、停机指令、关中断指令等。
2. 零地址的运算类指令仅用在**堆栈计算机**中。通常参与运算的两个操作数隐含地从栈顶和次栈顶弹出，送到运算器进行运算，运算结果再隐含地压入堆栈。

### 1.2 一地址指令

```assembly
OP A1
```

这种指令也有两种常见的形态，要根据操作码的含义确定它究竟是哪一种。

1. 只有目的操作数的单操作数指令，按 `A1` 地址读取操作数，进行 OP 操作后，结果存回原地址。

   指令含义：`OP(A1)→A1`

   如操作码含义是加 1，减 1，求反、求补等。

2. 隐含约定目的地址的双操作数指令，按指令地址 `A1` 可读取源操作数，指令可隐含约定另一个操作数由 ACC（累加器）提供，运算结果也将存放在 ACC 中。

   指令含义：`(ACC)OP(A1)→ACC`

若指令字长为 32 位，操作码占 8 位，1 个地址码字段占 24 位，则指令操作数的直接寻址范围为 2²⁴=16M。

### 1.3 二地址指令

```assembly
OP A1 A2
```

指令含义：`(A1)OP(A2)→A1`

对于常用的算术和逻辑运算指令，往往要求使用两个操作数，需分别给出**目的操作数**和**源操作数**的地址，其中目的操作数地址还用于保存本次的运算结果。

若指令字长为 32 位，操作码占 8 位，两个地址码字段各占 12 位，则指令操作数的直接寻址范围为 2¹²=4K。

### 1.4 三地址指令

```assembly
OP A1 A2 A3
```

指令含义：`(A1)OP(A2)→A3`

若指令字长为 32 位，操作码占 8 位，3 各地址码字段各占 8 位，则指令操作数的直接寻址范围为 2⁸=256。若地址字段均为主存地址，则完成一条三地址需要 4 次访问存储器（取指令 1 次，取两个操作数 2 次，存放结果 1 次）。

### 1.5 四地址指令

```assembly
OP A1 A2 A3 A4
```

指令含义：`A1(OP)A2→A3, A4=address of next instruction`

若指令字长为 32 位，操作码占 8 位，4 个地址码字段各占 6 位，则指令操作数的直接寻址范围为 2⁶=64。

## 2. 定长操作码指令格式

定长操作码指令在指令字的最高位部分分配固定的若干位（定长）表示操作码。一般 n 位操作码字段的指令系统最大能够表示 `2^n` 条指令。

定长操作码对于简化计算机硬件设计，提高指令译码和识别速度很有利。当计算机字长为 32 位或更长时，这是常规做法。

## 3. 拓展操作码指令格式

为了在指令字长有限的前提下仍保持比较丰富的指令种类，可采取可变长度操作码，即全部指令的操作码字段的位数不固定，且分散地放在指令字的不同位置上。显然，这将增加指令译码和分析的难度，使控制器的设计复杂化。

最常见的变长操作码方法是**扩展操作码**，它使操作码的长度随地址码的减少而增加，不同地址数的指令可具有不同长度的操作码，从而在满足需要的前提下，有效地缩短指令字长。

```assembly
OP    A1   A2   A3
;-------------------------- 4 位操作码
0000  A1   A2   A3
0001  A1   A2   A3
...                         ; 15 条三地址指令 
1110  A1   A2   A3
;-------------------------- 8 位操作码
1111 0000  A2   A3
1111 0001  A2   A3
...                         ; 15   条二地址指令 
1111 1110  A2   A3
;-------------------------- 12 位操作码
1111 1111 0000  A3
1111 1111 0001  A3  
...                         ; 15 条一地址指令 
1111 1111 1110  A3  
;-------------------------- 16 位操作码
1111 1111 1111 0000
1111 1111 1111 0001  
...                         ; 16 条零地址指令 
1111 1111 1111 1111   
```

如上图，指令字长为 16 为，其中 4 位位基本操作码字段 OP，另有 3 个 4 位长的地址字段 A1、A2 和 A3。4 位基本操作码若全部用于三地址指令，则有 16 条。而上图所示的三地址指令为 15 条，1111 留作扩展操作码之用；二地址指令为 15 条，1111 1111 留作扩展操作码之用；一地址指令为 15 条，1111 1111 1111 留作 扩展码之用；零地址指令为 16 条。

除这种安排外，还有其他多种扩展方法，如形成 15 条三地址指令、12 条二地址指令、63 条一地址指令和 16 条零地址指令，共 106 条指令。（方法基本一样，只不过是 1111 1011 作为二地址指令的最后一个指令）

在设计扩展操作码指令格式时，必须注意以下两点：

1. 不允许短码是长码的前缀，即短操作码不能与长操作码的前面部分的代码相同。
2. 各指令的操作码一定不能重复。

通常情况下，对使用频率较高的指令分配较短的操作码，对使用频率较低的指令分配较长的操作码，从而尽可能减少指令译码和分析的时间。

## 4. 习题

1. 属于程序控制指令的有啥？
2. 机器字长为 32 位，容量大小位 16MB 的存储器，CPU 按半字寻址，其寻址单元数为？

## 5. 习题答案

1. 无条件转移、有条件转移、子程序调用和返回指令、循环指令等。注意中断隐含指令是由硬件实现的，并不是指令系统中存在的指令，更不可能属于程序控制指令。
2. 半字就是 2B，16MB/2B = 8M = 2²³ 个单元。 

