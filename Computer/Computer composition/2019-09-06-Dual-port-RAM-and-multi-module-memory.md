---
title: 3.5 双端口 RAM 和多模块存储器
date: 2019-11-15
---

为了提高 CPU 访问存储器的速度，可以采用双端口存储器、多模块存储器等技术，它们同属并行技术，前者为空间并行，后者为时间并行。

## 1. 双端口 RAM

双端口 RAM 是指同一个存储器有左右两个独立的端口，分别具有两组相互独立的地址线、数据线和读写控制线，允许两个独立的控制器同时异步地访问存储单元。当两个端口的地址不相同时，在两个端口上进行读写操作一定不会发生冲突。两个端口同时存取存储器的同一地址单元时，会因数据冲突造成数据存储或读取错误。两个端口对同一主存操作有以下 4 种情况。

1. 两个端口不同时对同一地址单元存取数据。
2. 两个端口同时对同一地址单元读出数据。
3. 两个端口同时对同一地址单元写入数据。
4. 两个端口同时对同一地址单元操作，一个写入数据，另一个读出数据。

其中，第 1 和第 2 种情况不会出现错误；第 3 种情况会出现写入错误；第 4 种情况会出现读出错误。

解决方法：置 “忙” 信号 BUSY 为 0，由判断逻辑决定暂时关闭一个端口（即被延时），未被关闭的端口正常访问，被关闭的端口延长一个很短的时间端后再访问。

## 2. 多模块存储器

为提高访存速度，常采用多模块存储器，常用的有单体多字存储器和多体低位交叉存储器。

注意：CPU 的速度比存储器的快，若同时从存储器中取出 n 条指令，就可充分利用 CPU 资源，提高运行速度。多体交叉存储器就是基于这种思维提出的。

### 2.1 单体多字存储器

单体多字系统的特点是存储器中只有一个存储体，每个存储单元存储 m 个字，总线宽度也为 m 个字。一次并行读出 m 个字，地址必须顺序排列并处于同一存储单元。

单体多字系统在一个存取周期内，从同一地址取出 m 条指令，然后将指令逐条送至 CPU 执行，即每隔 1/m 存取周期，CPU 向主存取一条指令。显然，这增大了存储器的带宽，提高了单体存储器的工作速度。

缺点：指令和数据在主存内必须是连续存放的，一旦遇到转移指令，或操作数不能连续存放，这种方法的效果就不明显。

### 2.2 多体并行存储器

多体并行存储器由多体模块组成。每个模块都有相同的容量和存取速度，各模块都有独立的读写控制电路、地址寄存器和数据寄存器。它们既能并行工作，又能交叉工作。

多体并行存储器分为高位交叉编址（顺序方式）和低位交叉编址（交叉方式）两种。

1. 高位交叉编址：高位地址表示体号，低位地址为体内地址。（P115）

   注意：由于采用高位交叉编址，故采用高位交叉编址方式的存储器仍是顺序存储器。

2. 低位交叉编址：低位地址为体号，高位地址为体内地址。由于程序连续存放在祥林体中，因此称采用此编址方式的存储器为交叉存储器。

多体模块结构的存储器采用低位交叉编址后，可在不改变每个模块存取周期的前提下，采用流水线的方式并行存取，提高存储器的带宽。

设模块字长等于数据总线宽度，模块存取一个字的存取周期为 T，总线传送周期为 r，为实现流水线方式存取，存储器交叉模块数应大于等于 

`m=T/r` 

式中，m 称为交叉存取度。每经过 r 时间延迟后启动下一个模块，交叉存储器要求其模块数必须大于等于 m，以保证启动某模块后经过 m×r 的时间后再次启动该模块时，其上次的存取操作已经完成（即流水线不间断）。这样，连续存取 m 各字所需的时间为 

```matlab
t1 = T + (m-1)r
```

而顺序方式连续读取 m 个字所需时间为 `t2=mT` 。可见低位交叉存储器的带宽大大提高。

```markdown
设存储器容量为 32 个字，字长为 64 位，模块数 m=4，分别采用顺序方式和交叉方式进行组织。
存储周期 T = 200ns，数据总线宽度为 64 位，总线传输周期 r=50ns。
在连续读出 4 个字的情况下，求顺序存储器和交叉存储器各自的带宽。

解：顺序存储器和交叉存储器连续读出 m=4 个字的信息总量均是 
     q = 64位 × 4 = 256 位
   顺序存储器和交叉存储器连续读出 4 个字所需的时间分别是
     t1 = mT=4×200ns=800ns=8×10^(-7) s
     t2 = T + (m-1)r = 200ns + 3×50ns = 350ns = 35×10(-8) s
   顺序 存储器和交叉存储器的带宽分别是
     W1 = q/t1 = 256/(8x10^(-7))  = 32×10^7 b/s
     W2 = q/t2 = 256/(35×10^(-8)) = 73×10^7 b/s 
```

## 3. 习题

1. 什么是存取周期？

2. 四体并行低位交叉存储器有何特点。

3. 一个四体并行低位交叉存储器，每个模块的容量是 64K×32 位，存取周期为 200ns，总线周期为 50ns，那么一个存取周期内存储器可以向 CPU 提供多少位二进制信息？

4. 四体并行低位交叉存储器

   1. 读取 6 个连续地址单元中存放的存储字，重复 60 次
   2. 读取 8 个连续地址单元中存放的存储字，重复 60 次

   所花费时间之比为？

5. 高位四体交叉存储器可能在一个存储周期内连续访问 4 个模块吗？

6. 某计算机主存按字节编址，由 4 个 64M×8 的 DRAM 芯片采用交叉编码方式构成，并与宽度为 32 位的存储器总线相连，主存每次最多读 32 位数据，若 double 型变量 x 的主存地址为 804001AH，则读取 x 需要的存储周期数是？

7. 多字单体和单字多体的比较

8. 高位存储器缺点

9. 多体和单体多端口比较

## 4. 习题答案

1. 两次存取存储芯片的时间间隔。

2. 如果题目没有特意说明，那么四体是可以进行流水线读取的，也就是说存取周期/4 小于等于传送总线周期 r。

   主存地址最低两位表示该字节存储的芯片编号

3. 32×4 位，因为低位交叉存储器采用流水线技术，可以在一个存取周期内连续访问 4 个模块。

4. 情况 1：在每轮读取存储器的前 6 个 T/4 时间（共 3T/2）内，依次进入各体。下一次欲读取存取器时，最近访问的 M1 孩子占用中（才过 T/2 时间），因此必须再等待 T/2 的时间才能开始读取（M1 连续完成两次读取，也即总共 2T 的时间即可进入下一轮）。最后一轮读取结束的时间是本轮第 6 个字读取技术，共 (6-1)×(T/4) + T = 2.25T。所以总时间为 (80-1)×2T+2.25 = 160.25T。

   情况 2：每轮读取 8 个存储字刚好经过 2T 的时间，每轮结束后，最近访问的 M1 刚好经过了时间 T，此时可以立即开始下一轮的读取，最后一轮读取结束的时间是本轮第 8 个字读取结束，共 (8-1)×(T/4)+T=2.75T。所以总时间为 (60-1)×2T+2.75T=120.75T。

   情况 1 的总时间  : 情况 2 的总时间 = 160.25 : 120.75 = 4 : 3

5. 可以，只要同时访问的 4 个数据在不同的模块中即可

6. 题目废话很多，还是真题！！，double 是 64 位，相当于连续的 8 个字节，即然是低位交叉按字节编码，说明是流水线的方式存取字节，直接上公式为 T+(8-1)×(T/4)= 11T/4 > 2，所以是 3 个存取周期。

7. 多字单体快，但是灵活性不好，还需要多用几个缓冲寄存器。

8. 忽视了局部性原理，导致多体使用不平衡现象。

9. 单体多端口容易冲突，扩大存储容量的难度也比多体大。