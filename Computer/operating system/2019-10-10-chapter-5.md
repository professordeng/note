---
title: 5. I/O management
---

## 本章难点

1. 分配设备。首先根据 I/O 请求中的物理设备名查找系统设备表（SDT），从中找到该设备的 DCT，再根据 DCT 的设备状态字段，可知该设备是否正忙。若忙，便将请求 I/O 进程的 PCB 挂到设备队列上；若空闲，则按照一定的算法计算设备分配的安全性，若安全则将设备分配给请求进程，否则仍将其 PCB 挂在设备队列上。
2. 分配控制器。系统把设备分配给请求 I/O 的进程后，再到其 DCT 中找到与该设备连接的控制器的 COCT，从 COCT 的状态字段中可知控制器是否忙碌。若忙，则将请求 I/O 进程的 PCB 挂到该控制器的等待队列上；若空闲，则将控制器分配给进程。
3. 分配通道。在该 COCT 中又可找到与该控制器连接的通道的 CHCT，再根据 CHCT 内的状态信息，可知该通道是否忙碌。若忙，则将请求 I/O 的进程挂到该通道的等待队列上；若空闲，则将该通道分配给进程。只有在上述三者都分配成功时，这次设备的分配才算成功。然后，便可启动该 I/O 设备进行数据传送。

为使独占设备的分配具有更强的灵活性，提高分配的成功率，还可从以下两方面对基本的设备分配程序加以改进：

1. 增加设备的独立性。进程使用逻辑设备名请求 I/O。这样，系统首先从 SDT 中找到第一个该类设备的 DCT。若该设备忙，则又查找第二个该类设备的 DCT。仅当所有该类设备都忙时，才把进程挂到该类设备的等待队列上，只要有一个该类设备可用，系统便进一步计算分配该设备的安全性。
2. 考虑多通路情况。为防止 I/O 系统的 “瓶颈” 现象，通常采用多通路的 I/O 系统结构。此时对控制器和通道的分配同样要经过几次反复，即若设备（控制器）所连接的第一个控制器（通道）忙时，则应查看其所连接的第二个控制器（通道），仅当所有控制器（通道）都忙时1，此次的控制器（通道）分配才算失败，才把进程挂到控制器（通道）的等待队列上。而只要有一个控制器（通道）可用，系统便可将它分配给进程。

设备分配过程中，先后分别访问的数据结构为 SDT→DCT→COCT→CHCT。要成功分配一个设备，必须要：

1. 设备可用
2. 控制器可用
3. 通道可用。

所以，“设备分配，要过三关”。