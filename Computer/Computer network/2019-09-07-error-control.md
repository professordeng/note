---
title: 3.3 差错控制
date: 2019-11-09
---

注意：有不懂的请结合 《计算机组成原理》 第 2 章有关校验码的内容对比复习。

概括地说，传输中的差错都是由噪音引起的。噪音有两大类：一类是信道所固有的、持续存在的**随机热噪声**；另一类是由外界特定的短暂原因所造成的**冲击噪声**。前者可以通过提高信噪比来减少或避免干扰，而后者不可能靠提高信号幅度来避免干扰造成的差错，是产生差错的重要原因。

通常利用编码技术进行差错控制，主要有两类：自动重传请求（Automatic Retransmission reQuest ，ARQ）和前向纠错（Forward Error Correction，FEC）。在 ARQ 方式中，接收端检测出差错时，就设法通知发送端重发，直到接收到正确的码字为止。在 FEC 方式中，接收端不但能发现差错，而且能确定二进制数码的错误位置，从而加以纠正。因此，差错控制又可分为检错编码（Error-Detecting Code）和纠错编码（Error-Correcting Code）。

## 1. 检错编码

检错编码都采用冗余编码技术，其核心思想是在有效数据（信息位）被发送前，先按某种关系附加一定的冗余位，构成一个符合某一规则的码字后再发送。当要发送的有效位数据变化时，相应的冗余位也随之变化，使得码字遵从不变的规则。接收端根据收到的码字是否仍符合原规则来判断是否出错。常见的检错编码有奇偶检验码和循环冗余码。

### 1.1 奇偶校验码

奇偶检验码是奇检验码和偶检验码的统称，是一种最基本的检错码。它由 n-1 位信息和 1 位校验元组成，如果是奇检验码，那么在附加一个校验元后，码长为 n 的码字中 1 的个数为奇数（偶数个信息位为 1 的话补 1，反之补 0）；如果是偶检验码，那么在附加一个校验元以后，码长为 n 的码字中 1 的个数为 偶数（奇数个消息位为 1 的话补 1，否则补 0）。它又分为垂直奇偶检验、水平奇偶校验和水平垂直奇偶校验。

### 1.2 循环冗余码

循环冗余码（Cyclic Redundancy Code，CRC）又称多项式码，任何一个由二进制数位串组成的代码都可以与一个只含有 0 和 1两个系数的多项式建立一一对应关系。一个 k 位帧可以视为从 X^(k-1) 到 X^0 的 k 次多项式的系数序列，这个多项式的阶数为 k-1，高位是 X^(k-1) 项的系数，下一位是 X^(k-2) 的系数，以此类推。例如，1110011    有 7 位，表示成多项式是 `X^6+X^5+X^4+X+1` ，而多项式 `X^5+X^4+X^2+X` 对应的位串是 110110 。

给定一个 m bit 的帧或报文，发送器生成一个 r bit 的序列，称为帧检测序列（FCS），这样形成的帧将由 m+r 比特组成。发送方和接收方事先商定一个多项式 G(x) （最高位和最低位必须为 1），使这个待校验码的帧刚好能被预先确定的多项式 G(x) 整除。接收方用相同的多项式去除收到的帧，如果无余数，那么认为无差错。

假设一个帧有 m 位，其对应的多项式为 M(x) ，则计算冗余码的步骤如下：

1. 加 0 。假设 G(x) 的阶为 r，在帧的低位端加上 r 个 0 。
2. 模 2 除 。利用模 2 除法，用 G(x) 对应的数据串去除 1 中计算出的数据串。得到的余数即为冗余码（共 r 位，前面的 0 不可省略）。

多项式以 2 为模运算。按照模 2 运算规则，加法不进位，减法不借位，它刚好是异或操作。乘除法类似于二进制的运算，只是在做加减法时按模 2 规则进行。

冗余码的计算举例：设 G(x)=1101(即 r=3)，待传送数据 M=101001（即 m=6），经模 2 除法运算后的结果是：商 Q=110101（这个商没什么用），余数 R=001 。所以发送出去的数据为 101001001（即 2^r×M+FCS），共 m+r 位。

接收方做同样的运算，如果冗余码不一样，说明出错。

## 2. 纠错编码

在数据通信的过程中，解决差错问题的一种方法是在每个要发送的数据块上附加足够的冗余信息，使接收方能够推导出发送方实际送出的应该是什么样的比特串。**最常见的纠错编码是海明码**，他能发现双比特错，但只能纠正单比特错。

海明编码将码字内的位从左至右依次编号，第 1 位是 1 号，第 2 位是 2 号 …… 第 n 位是 n 号，编号为 2 的幂的位（1 号位、2 号位、4 号位、8 号位等）是校验位，其余的位填入 m 位数据。每个校验位的取值应使得包括自身在内的一些位的集合服从规定的奇偶性（如偶性要求这些位的集合中 1 的个数是偶数）。为了知道编号为 k 的数据位对那些检验位有影响，将编号 k 改写成 2 的幂的和，如 11 = 1+2+8，29=1+4+8+16 。一个位只由拓展式中所示编号的位检测，如编号为 11 的位只由编号为 1、2 和 8 的检验位检测。

m 个信息位插入 r 个检验位组成 m+r 位码字，它们必须满足的关系是 2^r≥m+r+1 。以典型的 4 位数据编码为例，海明码将加入 3 个检验码，从而实际传输 7 位码字：

```c++
index   : 1  2  3  4  5  6  7
code    : P1 P2 D1 P3 D2 D3 D4
explain : Px 是校验码，Dx 为数据码
```

先以数据 1101 为例讲述海明码的编码原理。此时

1. D1=1=1，D2=1，D3=0，D4=1
2. 对于数据位的编号，有 1=1，2=2，3=1+2，4=4，5=1+4，6=2+4，7=1+2+4。
3. P1 对应的数据位为 1，3，5，7，令 P1⊕D1⊕D2⊕D4=0（⊕ 表示异或操作），得 P1=1
4. P2 对应的数据位为 2，3，6，7，令 P2⊕D1⊕D3⊕D4=0，得 P2=0
5. P3 对应的数据位为 4，5，6，7，令 P3⊕D2⊕D3⊕D4=0，得 P3=0 

因此，海明编码的结果就是 1010101 。

接下来讨论如何纠错。接收方收到的正确码字应为 1010101 ，如果 D3 在传输途中因干扰而变成了 1，那么接收方就收到了 1010111，检测时

1. P1⊕D1⊕D2⊕D4=0，第一位纠错代码为 0，正确
2. P2⊕D1⊕D3⊕D4=1，第二位纠错代码为 1，有错误
3. P3⊕D2⊕D3⊕D4=1，第三位纠错代码为 1，有错误

将三个纠错代码从高到低排列为二进制编码 110，换算成十进制数就是 6，也就是说第 6 位数据错了，而数据 D3 在海明编码后的位置正好是第 6 位，取反即可。

## 3. 查缺补漏

1. 数据链路层的差错控制包括检错编码和纠错编码。意思是有纠错能力
2. 奇偶校验码中，若出现的结果中 1 的个数是奇数个，不能判断是否错误
3. 奇偶校验码可以检测出奇数个比特错误
4. 海明码 “纠错” d 位，需要码距为 2d+1 的编码方案；“检错” d 位，则只需码距为 d+1
5. 带 r 个校验位的多项式编码可以检测到所有长度小于等于 r 的突发性错误