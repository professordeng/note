---
title: 4.7 移动 IP
date: 2019-11-22
---

## 1. 移动 IP 的概念

支持移动性的因特网体系结构与协议共称为移动 IP。它是为了满足移动结点（计算机、服务器、网段等）在移动中保持其连接性而设计的。更确切地说，移动 IP 技术是指移动结点以固定的网络 IP 地址实现跨越**不同网段**的漫游功能，并保证基于网络 IP 的**网络权限**在漫游过程中不发生任何改变。移动 IP 的目标是把分组自动地投递给移动结点。一个移动结点是把其连接点从一个网络或子网络改变到另一个网络或子网的主机。使用移动 IP，**一个移动结点可以在不改变其 IP 地址的情况下改变其驻留位置**。

基于 IPv4 的移动 IP 定义三种功能实体：移动结点、归属代理（也称本地代理）和外埠代理（也称外部代理）。归属代理和外埠代理又统称为移动代理。

1. 移动结点。具有永久 IP 地址的移动结点
2. 本地代理。在一个网络环境中，一个移动结点的**永久 “居所”** 被称为归属网络，在归属网络中代表移动结点执行移动管理功能的实体称为归属代理（本地代理），它根据移动用户的转交地址，采用**隧道技术**转交移动结点的数据报。
3. 外部代理。在**外部网络**中帮助移动结点完成移动管理功能的实体称为外部代理。

移动 IP 和移动自组网络并不相同，移动 IP 技术使漫游的主机可以用**多种方式连接到因特网**，移动 IP 的核心网络功能仍然是基于固定互联网中一直使用的各种路由选择协议，移动自组网络是将移动性**拓展到无线领域中的自治系统**，它具有自己独特的路由选择协议，并且可以不和因特网相联。

移动 IP 和动态 IP 是两个完全不同的概念，动态 IP 指的是局域网中的计算机可以通过网络中的 DHCP 服务器动态地获得一个 IP 地址，而不需要用户在计算机的网络设置中指定 IP 地址，动态 IP 和 DHCP 经常会应用在我们的实际工作环境中。

## 2. 移动 IP 通信过程

在移动 IP 中，每个移动结点都有一个唯一的本地地址，当移动结点移动时，它的**本地地址是不变的**，在本地网络链路上每个本地结点还必须有一个本地代理来为它维护**当前的位置信息**，这就需要引入转交地址。当移动结点连接到外地网络链路上时，**转交地址就用来标识移动结点现在所处的位置**，以便进行路由选择。移动结点的本地地址与当前转交地址的联合称为**移动绑定**或简称绑定。当移动结点得到一个新的转交地址时，通过绑定向本地代理进行注册，以便让本地代理即时了解移动结点的当前位置。

移动 IP 技术的基本通信流程如下：

1. 移动结点在本地网时，按传统的 TCP/IP 方式进行通信（在本地网中有固定的地址）。
2. 移动结点漫游到一个外地网络时，仍然使用固定的 IP 地址进行通信。为了能够收到通信对端发给它的 IP 分组，移动结点需要向本地代理注册当前的位置地址，这个位置地址就是转交地址（它可以是**外部代理的地址或动态配置的一个地址**）。
3. 本地代理接收来自转交地址的注册后，会构建一条**通向转交地址的隧道**，将截获的发给移动结点的 IP 分组通过隧道送到转交地址处。
4. 在转交地址处解除隧道封装，恢复原始的 IP 分组，最后送到移动结点，这样移动结点在外网就能够收到这些发送给它的 IP 分组。
5. 移动结点在外网通过**外网的路由器**或外部代理向通信对端发送 IP 数据包。
6. 移动结点来到另一个外网时，只需**向本地代理更新注册的转交地址**，就可继续通信。
7. 移动结点回到本地网时，移动结点向本地代理注销转交地址，这时移动结点又将使用传统的 TCP/IP 方式进行通信。

移动 IP 为移动主机设置了**两个 IP 地址**，即主地址和辅地址（转交地址）。移动主机在本地网时，使用的是主地址。当移动到另一个网络时，需要获得一个临时的辅地址，但此时主地址仍然不变。从外网移回本地网时，辅地址改变或撤销，而主地址仍然保持不变。

## 3. 查缺补漏

1. 移动结点到达新我网络后，通过注册过程把自己新的可达信息（转交地址）通知归属代理（主地址）。这样，归属代理就可将发往移动结点的分组通过隧道转到转交地址（外部代理），再由外部代理交付给移动结点。
2. 当一个分组到达用户的本地 LAN 时，它被转发给某一台本地 LAN 相连的路由器。该路由器寻找目的主机，这时本地代理响应该请求，将这些分组封装到一些新 IP 分组的载荷，并将新分组发送给外部代理，外部代理将原分组解出来后，移交给移动后的主机。
3. 一个不在本地网络的用户即不可以直接接收分组，也不可以直接发送分组。

