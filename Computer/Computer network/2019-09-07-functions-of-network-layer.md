---
title: 4.1 网络层的功能
date: 2019-11-16
---

## 1. 异构网络关联

要在全球范围内把数以百万计的网络互联起来，并且能够互相通信，是一项非常复杂的任务，此时需要解决许多问题，比如**不同的寻址方案**、**不同的网络接入机制**、**不同的差错处理方法**、**不同的路由选择机制**等。用户的需求是多样的，没有一种单一的网络能适应所有用户的需求。网络层所要完成的任务之一就是**使这些异构的网络实现互联**。

所谓的网络互联，是指将两个以上的计算机网络，通过一定的方法，用一种或多种通信处理设备（即中间设备）相互连接起来，以构成更大的网络系统。中间设备又称**中间系统**或中继系统。根据所在的层次，中继系统分为以下 4 种：

1. 物理层中继系统：中继器，集线器（Hub）。
2. 数据链路层中继系统：网桥或交换机。
3. 网络层中继系统：路由器。
4. 网络层以上的中继系统：网关。

使用物理层或数据链路层的中继系统时，只是把一个网络扩大了，而从网络层的角度看，它仍然是同一个网络，一般并不称为网络互联。因此网络互联通常是指**用路由器进行网络互联和路由选择**。**路由器是一台专用计算机**，用于互联网中进行路由选择。

TCP/IP 体系在网络互联上采用的做法是在网络层（即 IP 层）采用标准化协议，但相互连接的网络可以是异构的。许多计算机网络通过一些路由器进行互联。由于参加互联的计算机网络都**使用相同的网际协议**（Internet Protocol，IP），因此可以把互联后的计算机网络视为一个虚拟 IP 网络。

虚拟互联网络也就是逻辑互联网络，即互联起来的各种物理网络的异构性本来是客观存在的，但是通过使用 IP 就可以使这些性能各异的网络在网络层上**看起来好像是一个统一的网络**。这种使用 IP 的虚拟互联网可简称 IP 网络。

使用虚拟互联网的好处是：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互联的具体的网络异构细节（如具体的编址方案、路由选择协议等）。

## 2. 路由与转发

路由器主要完成两个功能：一是**路由选择**（确定哪一条路径），二是**分组转发**（当一个分组到达时所采取的动作）。前者是根据特定的路由选择协议构造出路由表，同时**经常或定期地和相邻路由器交换路由信息**而**不断地更新和维护路由表**。后者处理通过路由器的数据流，关键操作是**转发表查询**、**转发及相关的队列管理和任务调度**等。

1. 路由选择。指按照复杂的分布式算法，根据从各相邻路由器所得到的关于整个网络拓扑的变化情况，动态地改变所选择的路由。
2. 分组转发。指路由器根据转发表将用户的 IP 数据报从合适的端口转发出去。

**路由表是根据路由选择算法得出的，而转发表是从路由表得出的**。转发表的结构应当**使查找过程最优化**，路由表则需要**对网络拓扑变化的计算最优化**。在讨论路由选择的原理时，往往不去区分转发表和路由表，而是笼统地使用路由表一词。

## 3. 拥塞控制

在通信子网中，因出现过量的分组而引起网络性能下降的现象称为**拥塞**。例如，某个路由器所在链路的带宽为 R B/s，如果 IP 分组只从它的某个端口进入，那么其速率为 rm B/s。当 rm=R 时，可能看起来是件 “好事”，因为链路带宽被充分利用。但是，当分组达到路由器的速率接近 R 时，平均时延急剧增加，并且会有大量的分组被丢弃（路由器端口的缓冲区是有限的）。整个网络的吞吐量会骤降，源与目的地之间的平均时延也会变得近乎无穷大。

判断网络是否进入拥塞状态的方法是，观察网络的**吞吐量与网络负载的关系**，如果随着网络负载的增加，网络的吞吐量明显小于正常的吞吐量，那么网络就可能已进入 “轻度拥塞” 状态；如果网络的吞吐量随着网络负载的增大而下降，那么网络就可能已进入**拥塞状态**；如果网络的负载继续增大，而网络的吞吐量下降到零，那么网络就可能已进入**死锁状态**。

为避免拥塞现象的出现，要采用防止拥塞的一系列方法对子网进行**拥塞控制**。拥塞控制主要解决的问题是如何获取网络中发生拥塞的信息从而利用这些信息进行控制，以避免由于拥塞而出现**分组的丢失**，以及严重拥塞而产生**网络死锁**的现象。

拥塞控制的作用是确保子网能够承载所达到的流量，这是一个全局性的过程，涉及各方面的行为：主机、路由器及路由器内部的转发处理过程等。单一地增加资源并不能解决拥塞。

流量控制和拥塞控制的区别：**流量控制往往是指发送端和接收端之间的点对点通信量的控制**。流量控制所要做的是抑制发送端发送数据的速率，以便使接收端来得及接收。而**拥塞控制必须确保通信子网能够传送待传送的数据**，是一个全局性的问题，涉及网络中所有的主机、路由器及导致网络传输能力下降的所有因素。

拥塞控制的方法有两种：

1. 开环控制。在设计网络时**事先**将有关发生拥塞的因素考虑周到，力求网络在工作时不产生拥塞。这是一种**静态的预防方法**。一旦整个系统启动并运行，中途就不再需要修改。开环控制手段包括确定何时可接收新流量、何时可丢弃分组及丢弃哪些分组，确定何种调度决策等。所有这些手段的共性是，在做决定时不考虑当前网络的状态。
2. 闭环控制。事先不考虑有关发生拥塞的各种元素，采用**监测网络系统**去监视，及时检测哪里发生了拥塞，然后将拥塞信息传到合适的地方，以便调整网络系统的运行，并解决出现的问题。闭环控制是基于反馈环路的概念，是一种**动态**的方法。

## 4. 查缺补漏

1. 网络层主要是 IP 协议，提供的是不可靠的服务。（1）
2. 异构网络指的是数据链路层和物理层协议都可以不同。（2）
3. 路由器可处理网络层及以下各层不同协议的网络，但上层协议必须相同。（4）
4. IP 和 ICMP 都属于网络层协议。TCP 属于传输层协议，FTP 属于应用层协议。（10）

